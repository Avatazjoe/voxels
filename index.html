<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" name="viewport" content="user-scalable=no, width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="icon" href="favicon.ico" />

    <title>Voronoi sphere</title>
    <meta name="description" content="voronoi sphere, spherical projection">
    <meta name="viewport" content="width=device-width">

    <link rel="stylesheet" href="css/app.css">
    <link rel="stylesheet" href="http://code.jquery.com/ui/1.11.4/themes/dot-luv/jquery-ui.min.css">
    <script src="http://code.jquery.com/jquery-2.1.4.min.js"></script>
    <script src="http://code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>

</head>
<body>
<div id="main"></div>
<div id="progressbar"><div id="progress-label">Loading...</div></div>
<div id="dialog" title="Voronoi sphere - Spherical projection">
    <p>Drag to move the view.</p>
    <p>Scroll / pinch to zoom.</p>
    <p>Double click / tap to hide UI.</p>
</div>
<div id="topbarLeft" class="gui">
    <button id="showHelp">?</button>
    <button id="fullscreen">fullscreen</button>
    <button id="reset">reset</button>
    <button id="screenshot">screenshot</button>
    <button id="megaText">mega texture export</button>
</div>

<script id="shader-fs" type="x-shader/x-fragment">#ifdef GL_ES
#extension GL_OES_standard_derivatives : enable
  #endif

uniform vec4 u_borderColor;
uniform float u_borderWidth;

varying vec4 v_color;
varying float v_centerFlag;

varying float v_hemi0;
varying float v_hemi1;

float edgeFactor(const float thickness, const float centerFlag)
{
  return smoothstep(0.0, fwidth(centerFlag)*thickness, centerFlag);
}

void main()
{
  if (v_hemi1 == 1.0 && ( v_hemi0 != 0.0 && v_hemi0 != 1.0 ) ) {
    // back hemisphere AND crossing east and west hemispheres
    gl_FragColor = vec4(0.0,0.0,0.0,0.0);
  } else {
    vec4 col = v_color;
    float f = edgeFactor(u_borderWidth, v_centerFlag);
    gl_FragColor = mix(u_borderColor, col, f);
  }
}
</script>
<script id="shader-vs" type="x-shader/x-vertex">#ifdef GL_ES
#extension GL_OES_standard_derivatives : enable
#endif

attribute float a_centerFlag;
attribute vec3 a_color;

uniform mat4 u_mMat;

varying vec4 v_color;
varying float v_centerFlag;

varying float v_hemi0;
varying float v_hemi1;

void main()
{
  vec4 rotPos = u_mMat * vec4(position, 1.0);
  float longi = atan( rotPos.x, rotPos.z );
  gl_Position = vec4( longi / 3.14159265359, log( ( 1.0+rotPos.y ) / ( 1.0-rotPos.y ) ) / 12.5663706144, 0.0, 1.0);
  v_color = vec4(a_color, 1.0);
  v_centerFlag = a_centerFlag;
  if (longi > 0.0) {
    v_hemi0 = 1.0; // east quadrant
  } else {
    v_hemi0 = 0.0; // west quadrant
  }
  if (abs(longi) > 1.57079632679) {
    v_hemi1 = 1.0; // back quadrant
  } else {
    v_hemi1 = 0.0; // front quadrant
  }
}
</script>
<script id="shader-maze-fs" type="x-shader/x-fragment">#ifdef GL_ES
#extension GL_OES_standard_derivatives : enable
  #endif

uniform vec3 u_color;

varying float v_hemi0;
varying float v_hemi1;

void main()
{
  if (v_hemi1 == 1.0 && ( v_hemi0 != 0.0 && v_hemi0 != 1.0 ) ) {
    // back hemisphere AND crossing east and west hemispheres
    gl_FragColor = vec4(0.0,0.0,0.0,0.0);
  } else {
    gl_FragColor = vec4 (u_color, 1.0);
  }
}
</script>
<script id="shader-maze-vs" type="x-shader/x-vertex">#ifdef GL_ES
#extension GL_OES_standard_derivatives : enable
#endif

uniform mat4 u_mMat;

varying float v_hemi0;
varying float v_hemi1;

void main()
{
  vec4 rotPos = u_mMat * vec4(position, 1.0);
  float longi = atan( rotPos.x, rotPos.z );
  gl_Position = vec4( longi / 3.14159265359, log( ( 1.0+rotPos.y ) / ( 1.0-rotPos.y ) ) / 12.5663706144, 0.0, 1.0);
  if (longi > 0.0) {
    v_hemi0 = 1.0; // east quadrant
  } else {
    v_hemi0 = 0.0; // west quadrant
  }
  if (abs(longi) > 1.57079632679) {
    v_hemi1 = 1.0; // back quadrant
  } else {
    v_hemi1 = 0.0; // front quadrant
  }
}
</script>
<script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/three.js/r71/three.min.js"></script>
<script type="text/javascript" src="js/lib/threex.windowresize.js"></script>
<script type="text/javascript" src="js/lib/THREEx.FullScreen.js"></script>
<script type="text/javascript" src="js/lib/stats.min.js"></script>
<script type="text/javascript" src="http://hammerjs.github.io/dist/hammer.min.js"></script>
<script type="text/javascript" src="js/lib/dat.gui.min.js"></script>
<script type="text/javascript" src="target/scala-2.11/voronoi-sphere-opt.js"></script>
<script type="text/javascript" src="js/threeApp.js"></script>
</body>
</html>